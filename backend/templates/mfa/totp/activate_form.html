{% load allauth i18n %}
{% block content %}
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<style>
  :root {
    --panel-red: #609926;
    --panel-dark-green: #2e3626;
    --panel-bg: #f4f6f8;
  }

  html, body {
    height: 100%;
  }

  body {
    padding: 40px 0;
    background-color: var(--panel-bg);
  }

  a {
    color: var(--panel-red);
  }

  a:hover {
    color: #435233;
    text-decoration: none;
  }

  .auth-card {
    width: 100%;
    max-width: 760px;
    padding: 28px;
    margin: auto;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 8px 24px rgba(20, 33, 66, 0.15);
  }

  .auth-card h1,
  .auth-card h4,
  .auth-card h6 {
    color: var(--panel-dark-green);
  }

  .form-control:focus {
    border-color: var(--panel-red);
    box-shadow: 0 0 0 0.2rem rgba(207, 20, 43, 0.25);
  }

  .btn-primary {
    background-color: var(--panel-red);
    border-color: var(--panel-red);
    font-weight: 600;
  }

  .btn-primary:hover,
  .btn-primary:focus {
    background-color: #609926;
    border-color: #609926;
  }

  .alert-info {
    background-color: rgba(20, 33, 66, 0.08);
    border-color: rgba(20, 33, 66, 0.15);
    color: var(--panel-dark-green);
  }

  .qr-box {
    background: #f8f9fa;
    border-radius: 6px;
  }

  .text-muted {
    color: #6c757d !important;
  }

  .copyright {
    font-size: 0.9rem;
  }
</style>

<div class="container text-center mt-5 mb-5">

  <div class="auth-card mt-5 mb-5">


    <h1 class="h4 mb-3 font-weight-normal text-center">
      {% trans "Set Up Two-Factor Authentication" %}
    </h1>

    <p class="text-muted text-center mb-4">
      {% trans "This website requires an authenticator app to keep student accounts secure." %}
    </p>

    <!-- WHAT IS MFA -->
    <div class="alert alert-info text-left">
      <strong>{% trans "What is an authenticator app?" %}</strong><br>
      {% trans "An authenticator app generates a temporary 6-digit code on your phone. You will enter this code each time you sign in." %}
    </div>

    <!-- AUTHENTICATOR APPS -->
    <h6 class="mt-4 mb-3 text-center">
      {% trans "Recommended authenticator apps" %}
    </h6>

    <div class="row">

      <!-- Google -->
      <div class="col-md-6 mb-3">
        <div class="card h-100">
          <div class="card-body text-center">
            <h6 class="font-weight-bold">Google Authenticator</h6>

            <a
              href="https://apps.apple.com/us/app/google-authenticator/id388497605"
              target="_blank"
              class="btn btn-outline-dark btn-sm btn-block mb-2">
              iPhone App Store
            </a>

            <a
              href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en_US"
              target="_blank"
              class="btn btn-outline-success btn-sm btn-block">
              Android Play Store
            </a>
          </div>
        </div>
      </div>

      <!-- Microsoft -->
      <div class="col-md-6 mb-3">
        <div class="card h-100">
          <div class="card-body text-center">
            <h6 class="font-weight-bold">Microsoft Authenticator</h6>

            <a
              href="https://apps.apple.com/us/app/microsoft-authenticator/id983156458"
              target="_blank"
              class="btn btn-outline-dark btn-sm btn-block mb-2">
              iPhone App Store
            </a>

            <a
              href="https://play.google.com/store/apps/details?id=com.azure.authenticator&hl=en_US"
              target="_blank"
              class="btn btn-outline-success btn-sm btn-block">
              Android Play Store
            </a>
          </div>
        </div>
      </div>

    </div>

    <p class="small text-muted text-center mb-4">
      {% trans "You only need to install one of these apps." %}
    </p>

    <hr>

    <!-- SETUP INSTRUCTIONS -->
    <h6 class="mb-3 text-center">
      {% trans "How to set it up" %}
    </h6>

    <ol class="mb-4 text-left">
      <li>{% trans "Install Google Authenticator or Microsoft Authenticator on your phone." %}</li>
      <li>{% trans "Open the app and choose Add Account or Scan QR Code." %}</li>
      <li>{% trans "Scan the QR code shown below." %}</li>
      <li>{% trans "Enter the 6-digit code generated by the app." %}</li>
      <li>{% trans "Click Activate to finish setup." %}</li>
    </ol>

    <!-- ACTIVATION FORM -->
    {% url 'mfa_activate_totp' as action_url %}
    <form method="post" action="{{ action_url }}">
      {% csrf_token %}

      <div class="text-center mb-4 qr-box p-3">
        <img
          src="{{ totp_svg_data_uri }}"
          alt="{% trans 'QR Code' %}"
          class="img-fluid"
          style="max-width: 260px;">
      </div>

      <div class="form-group text-left">
        <label class="font-weight-bold small">
          {% trans "Manual setup code (optional)" %}
        </label>
        <input
          type="text"
          class="form-control form-control-sm"
          value="{{ form.secret }}"
          disabled>
        <small class="form-text text-muted">
          {% trans "Only use this if you cannot scan the QR code." %}
        </small>
      </div>

      {% for field in form %}
        {% if field.name != "secret" %}
          <div class="form-group text-left">
            <label class="font-weight-bold small">{{ field.label }}</label>
            <input
              type="{{ field.field.widget.input_type }}"
              name="{{ field.name }}"
              class="form-control {% if field.errors %}is-invalid{% endif %}"
              required>
            {% if field.errors %}
              <div class="invalid-feedback d-block">
                {{ field.errors|striptags }}
              </div>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}

      <button
        type="submit"
        class="btn btn-primary btn-block mt-3">
        {% trans "Activate Authenticator App" %}
      </button>
    </form>

    <p class="mt-5 mb-3 text-muted copyright">
      Copyright &copy; RansomNegotiator.
      All Rights Reserved.
    </p>

  </div>

</div>
{% endblock content %}